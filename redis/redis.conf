# Redis configuration for improved performance
# -------------------------------------------------

# MEMORY MANAGEMENT
# -------------------------------------------------
# Set maximum memory limit to 2GB
maxmemory 2gb

# Use LRU algorithm to evict keys when maxmemory is reached
maxmemory-policy volatile-lru

# LRU and minimal TTL algorithms are approximated
# Higher values provide better accuracy but use more memory
maxmemory-samples 5

# ACTIVE DEFRAGMENTATION
# -------------------------------------------------
# Enable active defragmentation
activedefrag yes

# Threshold defragmentation minimum amount
active-defrag-ignore-bytes 100mb

# Minimum percentage of fragmentation to start defragging
active-defrag-threshold-lower 10

# Maximum percentage of fragmentation at which we use maximum effort
active-defrag-threshold-upper 100

# Minimal effort for defrag in CPU percentage
active-defrag-cycle-min 5

# Maximal effort for defrag in CPU percentage
active-defrag-cycle-max 75

# GENERAL PERFORMANCE SETTINGS
# -------------------------------------------------
# Disable saving RDB snapshots to disk if the server is using less than 25% CPU and less than 50mb RAM
# This allows us to save memory and CPU during peak times
# But we still enable RDB snapshots for persistence
stop-writes-on-bgsave-error yes

# Set client output buffer limits
client-output-buffer-limit normal 0 0 0
client-output-buffer-limit pubsub 32mb 8mb 60
client-output-buffer-limit replica 256mb 64mb 60

# Use multiple I/O threads to execute non-blocking commands
io-threads 4
io-threads-do-reads yes

# Optimized TCP keep alive settings
tcp-keepalive 300

# Don't save empty databases to disk
# - 900 sec (15 min) if at least 1 key changed
# - 300 sec (5 min) if at least 10 keys changed
# - 60 sec if at least 10000 keys changed
save ""

# Disable AOF persistence in favor of RDB snapshots
appendonly no

# DATABASES OPTIMIZATION
# -------------------------------------------------
# Reduce number of databases to save memory if you're not using multiple DBs
databases 4

# Set hard limit for number of clients
maxclients 10000

# LATENCY SETTINGS
# -------------------------------------------------
# Run Redis with a higher scheduling priority to improve performance
# Range is -20 (highest) to 19 (lowest)
# Default 0 - Using -5 for higher priority
# Comment out if not running as root or with proper permissions
# schedulers-priority -5

# Disable Redis slowlog for production environments to save CPU cycles
slowlog-log-slower-than -1

# MEMORY OPTIMIZATION
# -------------------------------------------------
# Rehash main dictionary when needed
activerehashing yes

# Optimize memory usage for small datasets with ziplist
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
zset-max-ziplist-entries 128
zset-max-ziplist-value 64
set-max-intset-entries 512

# NETWORK SETTINGS
# -------------------------------------------------
# Bind to all network interfaces
bind 0.0.0.0

# Set TCP backlog
tcp-backlog 511

# Timeouts
timeout 30
tcp-keepalive 60


# LOGGING
# -------------------------------------------------
# Set appropriate logging level for production
# Options: debug, verbose, notice, warning
loglevel notice

